/*
 * funcs.c
 *
 * Created: 10/09/2021 13:40:38
 *  Author: Scott Porter
 */ 

#include "funcs.h"

// Used by interrupt handler to update the LED matrix
volatile uint8_t currentCol=0;
volatile uint8_t activeBuffer=0,drawBuffer=1;
volatile uint8_t switchBuffer=0;
volatile uint8_t buffOff=0;
volatile uint8_t cBit=0;

// Current video mode. "SLOW" mode allows for two brightnesses (plus black), "FAST" mode is
// either full brightness or black, but uses less CPU time to update the display. I use "FAST"
// mode in the game-of-life animation, to make calculations faster, as the animation doesn't 
// need 2 brightnesses anyway!
uint8_t videoMode=VIDEO_MODE_SLOW;

// Current button state as a bit field
uint8_t butState=0;

// Display buffers (one is always active, the other is available for writing, so we can flip quickly and avoid glitching)
uint8_t buffer[2][MAX_COL*2]={0};

// Character set (A-Z 0-9) - used to scroll text vertically
const uint8_t charDef[576] = {
	0x18,0x03,0x1c,0x07,0x0c,0x06,0x1c,0x07,0x1c,0x07,0x0c,0x06,0x0c,0x06,0x0c,0x06, // 0
	0x1c,0x03,0x1c,0x07,0x0c,0x06,0x1c,0x03,0x1c,0x03,0x0c,0x06,0x1c,0x07,0x1c,0x03, // 1
	0x18,0x03,0x1c,0x07,0x0c,0x00,0x0c,0x00,0x0c,0x00,0x0c,0x00,0x1c,0x07,0x18,0x03, // 2
	0x1c,0x01,0x1c,0x03,0x0c,0x07,0x0c,0x06,0x0c,0x06,0x0c,0x07,0x1c,0x03,0x1c,0x01, // 3
	0x1c,0x07,0x1c,0x07,0x0c,0x00,0x1c,0x01,0x1c,0x01,0x0c,0x00,0x1c,0x07,0x1c,0x07, // 4
	0x1c,0x07,0x1c,0x07,0x0c,0x00,0x1c,0x01,0x1c,0x01,0x0c,0x00,0x0c,0x00,0x0c,0x00, // 5
	0x18,0x03,0x1c,0x07,0x0c,0x00,0x0c,0x07,0x0c,0x07,0x0c,0x06,0x1c,0x07,0x18,0x03, // 6
	0x0c,0x06,0x0c,0x06,0x0c,0x06,0x1c,0x07,0x1c,0x07,0x0c,0x06,0x0c,0x06,0x0c,0x06, // 7
	0x18,0x03,0x18,0x03,0x10,0x01,0x10,0x01,0x10,0x01,0x10,0x01,0x18,0x03,0x18,0x03, // 8
	0x00,0x06,0x00,0x06,0x00,0x06,0x00,0x06,0x00,0x06,0x0c,0x06,0x1c,0x07,0x18,0x03, // 9
	0x0c,0x06,0x0c,0x07,0x1c,0x03,0x1c,0x01,0x1c,0x01,0x1c,0x03,0x0c,0x07,0x0c,0x06, // 10
	0x0c,0x00,0x0c,0x00,0x0c,0x00,0x0c,0x00,0x0c,0x00,0x0c,0x00,0x1c,0x07,0x1c,0x07, // 11
	0x06,0x0c,0x0e,0x0e,0x1e,0x0f,0x1e,0x0f,0x16,0x0d,0x16,0x0d,0x06,0x0c,0x06,0x0c, // 12
	0x04,0x06,0x0c,0x06,0x1c,0x06,0x1c,0x07,0x1c,0x07,0x0c,0x07,0x0c,0x06,0x0c,0x04, // 13
	0x18,0x03,0x1c,0x07,0x0c,0x06,0x0c,0x06,0x0c,0x06,0x0c,0x06,0x1c,0x07,0x18,0x03, // 14
	0x1c,0x03,0x1c,0x07,0x0c,0x06,0x1c,0x07,0x1c,0x03,0x0c,0x00,0x0c,0x00,0x0c,0x00, // 15
	0x18,0x03,0x1c,0x07,0x0c,0x06,0x0c,0x06,0x0c,0x06,0x0c,0x07,0x1c,0x03,0x18,0x05, // 16
	0x1c,0x03,0x1c,0x07,0x0c,0x06,0x1c,0x03,0x1c,0x01,0x1c,0x03,0x0c,0x07,0x0c,0x06, // 17
	0x18,0x03,0x1c,0x07,0x0c,0x00,0x1c,0x03,0x18,0x07,0x00,0x06,0x1c,0x07,0x18,0x03, // 18
	0x1c,0x07,0x1c,0x07,0x10,0x01,0x10,0x01,0x10,0x01,0x10,0x01,0x10,0x01,0x10,0x01, // 19
	0x0c,0x06,0x0c,0x06,0x0c,0x06,0x0c,0x06,0x0c,0x06,0x0c,0x06,0x1c,0x07,0x18,0x03, // 20
	0x0c,0x06,0x0c,0x06,0x0c,0x06,0x0c,0x06,0x0c,0x06,0x1c,0x07,0x18,0x03,0x10,0x01, // 21
	0x06,0x0c,0x06,0x0c,0x16,0x0d,0x16,0x0d,0x1e,0x0f,0x1e,0x0f,0x0e,0x0e,0x06,0x0c, // 22
	0x0c,0x06,0x0c,0x06,0x18,0x03,0x10,0x01,0x18,0x03,0x0c,0x06,0x0c,0x06,0x0c,0x06, // 23
	0x0c,0x06,0x0c,0x06,0x0c,0x06,0x1c,0x07,0x18,0x03,0x10,0x01,0x10,0x01,0x10,0x01, // 24
	0x1c,0x07,0x1c,0x07,0x00,0x07,0x10,0x03,0x18,0x01,0x1c,0x00,0x1c,0x07,0x1c,0x07, // 25
	0x18,0x03,0x1c,0x07,0x0c,0x06,0x1c,0x06,0x0c,0x07,0x0c,0x06,0x1c,0x07,0x18,0x03, // 26
	0x00,0x01,0x10,0x01,0x10,0x01,0x10,0x01,0x10,0x01,0x10,0x01,0x18,0x03,0x18,0x03, // 27
	0x18,0x03,0x1c,0x07,0x00,0x06,0x18,0x07,0x1c,0x03,0x0c,0x00,0x1c,0x07,0x1c,0x07, // 28
	0x18,0x03,0x1c,0x07,0x00,0x06,0x10,0x07,0x10,0x07,0x00,0x06,0x1c,0x07,0x18,0x03, // 29
	0x0c,0x06,0x0c,0x06,0x0c,0x06,0x1c,0x07,0x1c,0x07,0x00,0x06,0x00,0x06,0x00,0x06, // 30
	0x1c,0x07,0x1c,0x07,0x0c,0x00,0x1c,0x03,0x1c,0x07,0x00,0x06,0x1c,0x07,0x18,0x03, // 31
	0x18,0x03,0x1c,0x07,0x0c,0x00,0x1c,0x03,0x1c,0x07,0x0c,0x06,0x1c,0x07,0x18,0x03, // 32
	0x1c,0x07,0x1c,0x07,0x00,0x06,0x00,0x07,0x10,0x03,0x18,0x01,0x1c,0x00,0x0c,0x00, // 33
	0x18,0x03,0x1c,0x07,0x0c,0x06,0x1c,0x07,0x1c,0x07,0x0c,0x06,0x1c,0x07,0x18,0x03, // 34
	0x18,0x03,0x1c,0x07,0x0c,0x06,0x1c,0x07,0x18,0x07,0x00,0x06,0x1c,0x07,0x1c,0x03, // 35
};

// Animation of spinning Solder logo - users can use left/right to rotate the logo after it
// has spun onto display.
// Format is 45 bytes per frame. Using 10 bits per row, packed into 45 bytes (45*8 = 360 bits = 36*10). 
// The "Next piece" LEDs are skipped when displaying animations. Note that the first 18 rows are for the 
// half-brightness pixels. If the second 18 rows then also enable the same pixels, then they are full 
// brightness. So it's 2 "planes" per frame. If the second plane of pixels are used on their own, they 
// are also only 1/2 brightness. This uses little endian format. So bit 0 of the first byte is the
// top left pixel. Bit 4 is the top 5th pixel along, etc. This makes it fast to calculate pixel positions.
const uint8_t logoSpinner[8100] PROGMEM={

	0,0,0,0,0,0,0,8,3,0,192,240,48,12,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,32,8,6,1,0,64,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,8,3,0,192,240,48,12,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,32,8,6,1,0,64,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,8,3,1,192,240,48,12,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,32,8,0,1,0,64,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,8,3,1,192,240,48,12,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,32,8,2,1,0,64,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,8,3,1,192,240,48,12,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,32,8,6,1,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,8,7,1,192,240,48,12,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,8,7,1,192,240,56,12,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,12,7,1,192,240,56,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,8,7,1,192,240,56,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,32,0,4,0,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,8,3,1,192,240,24,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,32,0,0,0,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,8,3,1,192,112,24,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,32,16,0,0,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,8,2,1,192,112,24,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,32,16,0,0,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,8,3,1,192,96,24,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,32,16,0,0,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,0,3,1,128,96,24,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,32,16,0,0,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,0,2,1,128,96,24,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,32,16,4,0,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,0,2,1,128,96,24,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,32,24,4,0,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,0,2,1,128,224,24,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,32,24,4,0,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,0,2,1,128,224,24,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,32,24,4,0,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,0,3,1,128,224,24,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,32,24,4,0,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,0,3,1,192,224,56,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,32,24,4,0,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,0,3,1,192,224,56,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,32,24,4,1,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,0,3,3,192,240,48,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,48,28,14,1,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,0,3,3,192,240,16,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,32,28,14,1,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,0,3,3,192,240,48,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,32,28,14,1,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,0,3,3,193,240,48,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,32,28,14,3,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,0,3,3,193,240,56,12,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,32,28,14,3,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,0,3,3,193,240,48,12,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,12,14,3,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,0,3,3,193,240,48,12,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,12,14,3,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,0,3,1,193,240,48,8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,12,15,3,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,0,1,1,193,240,48,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,12,15,3,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,0,0,0,193,240,112,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,12,15,3,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,0,0,0,192,240,112,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,14,3,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,0,0,2,192,240,116,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8,14,3,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,0,0,2,192,240,124,12,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8,4,0,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,0,0,3,192,240,124,12,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,28,4,0,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,0,0,3,192,240,60,8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,28,4,0,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,0,2,3,192,240,60,12,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,28,12,0,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,0,2,3,192,240,56,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,13,0,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,0,2,3,192,240,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,56,8,0,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,0,6,3,192,240,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,32,56,12,0,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,0,6,3,192,240,96,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,48,12,0,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,0,2,3,128,224,36,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,56,12,0,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,0,2,3,128,224,60,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,32,56,12,0,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,0,2,3,128,224,56,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,32,56,14,3,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,8,2,3,128,224,56,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,32,24,14,1,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,8,6,1,192,240,56,6,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,32,24,6,1,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,0,7,1,192,112,28,6,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,32,24,7,1,128,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,0,7,1,192,112,60,7,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,48,28,7,1,192,64,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,0,7,1,192,240,60,7,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,48,28,7,1,192,64,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,0,7,3,192,240,62,7,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,48,28,7,1,192,64,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,0,7,3,192,248,62,15,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,32,28,7,3,192,64,16,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,8,15,3,224,248,62,15,129,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,32,60,15,3,192,112,16,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,8,15,3,224,248,62,15,129,128,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,32,60,15,3,192,112,16,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,8,15,3,224,248,62,15,129,192,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,224,60,15,3,192,112,16,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,0,15,3,193,240,126,15,129,224,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,224,60,15,3,192,112,16,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,0,31,7,193,240,126,15,129,192,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,224,60,15,3,192,112,16,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,32,31,7,193,240,124,15,129,192,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,208,60,15,7,192,112,16,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,48,31,7,193,240,124,15,1,192,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,208,60,15,3,192,48,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,48,31,7,193,240,126,7,129,192,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,192,60,15,3,192,48,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,48,31,7,225,248,126,3,128,192,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,192,60,15,3,192,48,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,48,31,7,225,248,126,15,128,192,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,192,60,15,3,192,48,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,32,56,31,7,225,248,126,15,128,224,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,192,60,15,3,192,48,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,32,120,31,7,225,248,126,31,129,224,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,120,31,7,225,248,126,15,129,192,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,32,0,0,0,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,120,31,7,225,248,126,31,129,128,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,104,31,7,193,240,124,31,1,128,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,16,0,0,0,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,32,120,31,7,225,248,124,31,1,128,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,16,0,0,0,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,32,120,31,7,225,240,124,15,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,48,0,0,0,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,32,120,31,135,193,240,124,15,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,16,0,0,0,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,32,56,31,7,193,240,60,15,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,48,120,15,3,192,240,60,15,1,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,0,80,0,0,0,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,32,56,31,0,192,48,12,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,128,208,0,0,0,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,32,60,31,0,192,48,12,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,1,128,208,0,0,0,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,32,60,15,0,64,16,8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,1,128,192,0,0,0,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,32,60,15,3,128,224,56,14,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,192,224,48,0,0,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,32,60,15,3,192,240,60,15,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,192,240,48,0,0,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,48,28,15,131,224,240,28,7,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,192,240,48,0,0,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,48,12,15,131,224,248,28,7,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,192,240,60,7,0,192,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,16,12,15,131,224,248,30,7,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,192,248,62,7,1,192,48,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,16,14,15,131,240,248,62,7,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,192,120,62,7,129,192,32,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,14,31,135,240,248,14,7,0,128,0,0,0,0,0,0,0,0,0,0,0,0,0,0,192,248,63,7,128,192,32,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,14,15,199,240,248,14,7,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,192,248,127,15,128,64,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,14,15,199,240,252,6,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,224,252,127,15,128,64,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,14,15,199,241,252,62,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,224,252,127,15,128,64,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,14,15,199,241,252,62,7,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,224,252,127,31,194,96,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,14,15,231,243,252,126,5,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,224,252,127,31,195,96,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,14,27,231,243,252,127,5,128,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,225,188,127,31,135,96,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,14,27,231,251,252,255,4,192,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,60,127,31,195,96,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,14,19,231,251,252,255,4,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,60,127,31,199,112,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,14,3,231,251,254,255,156,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,60,127,31,199,240,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,15,3,239,251,254,255,191,192,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,60,127,31,199,241,192,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,3,3,239,251,254,255,191,192,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,60,15,31,199,241,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,3,3,227,251,254,255,159,198,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,28,15,31,199,241,192,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,7,3,227,251,254,255,191,199,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,48,0,0,0,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,7,3,195,243,254,255,159,134,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,32,48,16,28,0,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,14,3,195,241,254,255,159,135,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,96,48,16,12,0,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,16,14,3,195,241,254,255,191,199,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,192,48,48,28,4,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,16,14,3,131,241,252,127,159,131,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,192,32,48,28,4,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,48,14,7,195,145,194,112,40,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,192,32,48,28,6,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,48,14,7,195,57,194,112,24,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,0,224,124,49,28,7,1,128,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,48,14,7,195,120,198,112,24,4,0,0,0,0,0,0,0,0,0,0,0,0,0,3,0,224,124,55,12,103,0,128,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,48,30,7,195,240,206,96,8,4,0,0,0,0,0,0,0,0,0,0,0,0,0,3,1,224,124,31,12,226,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,120,30,7,195,240,254,63,159,199,224,192,0,0,0,0,0,0,0,0,0,0,0,3,1,224,120,31,15,192,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,56,62,15,195,240,252,63,15,195,224,208,0,0,0,0,0,0,0,0,0,0,0,3,1,224,248,63,15,195,48,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,184,62,15,131,241,252,127,31,195,224,248,48,0,0,0,0,0,0,0,0,0,0,3,3,224,248,62,15,135,240,192,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,48,62,31,135,225,248,127,31,135,225,248,112,0,0,0,0,0,0,0,0,0,0,3,3,192,248,126,31,135,225,248,112,0,0,0,0,0,0,0,
	0,0,0,0,0,128,48,124,31,7,225,248,254,63,143,227,248,120,28,0,0,0,0,0,0,0,0,0,3,7,193,240,124,31,15,227,248,240,48,0,0,0,0,0,0,
	0,0,0,0,0,192,112,124,31,15,195,240,252,63,159,199,240,252,28,0,0,0,0,0,0,0,0,0,2,7,129,240,124,63,15,195,240,252,124,0,0,0,0,0,0,
	0,0,0,0,0,128,112,124,63,15,195,240,252,127,159,199,241,252,60,0,0,0,0,0,0,0,0,8,3,7,195,224,248,62,15,131,241,252,126,31,0,0,0,0,0,
	0,0,0,0,0,128,112,252,63,15,227,249,254,127,159,199,241,252,124,0,0,0,0,0,0,0,0,0,3,7,195,224,248,62,15,135,225,248,126,31,2,0,0,0,0,
	0,0,0,0,0,192,240,254,63,143,231,249,254,127,159,199,241,252,126,7,0,0,0,0,0,0,0,0,7,7,67,192,240,60,31,7,193,240,124,31,7,192,0,0,0,
	0,0,0,0,0,192,248,254,63,159,247,253,255,127,223,199,241,252,127,31,0,0,0,0,0,0,0,12,3,6,67,128,224,120,30,7,129,224,120,30,7,128,0,0,0,
	0,0,0,0,0,224,248,127,63,223,247,253,255,127,223,199,241,252,127,31,0,0,0,0,0,0,0,12,3,135,227,249,254,127,159,231,241,248,126,31,199,193,192,0,0,
	0,0,0,3,0,224,124,255,63,223,247,253,255,127,223,199,241,252,127,31,3,128,0,0,0,0,0,12,3,135,227,248,254,63,159,247,225,248,126,31,135,225,240,0,0,
	0,0,0,3,128,240,124,255,127,223,247,255,255,255,223,199,241,252,127,31,135,192,0,0,0,0,0,14,3,197,243,252,255,63,223,247,225,248,126,31,135,225,240,48,0,
	0,0,0,3,192,240,124,255,191,255,255,255,255,255,223,199,241,252,127,31,135,192,0,0,0,0,16,15,3,193,243,252,255,63,207,247,225,248,126,31,135,225,240,56,0,
	0,0,12,3,224,248,126,223,191,255,255,255,255,255,223,135,225,248,126,31,135,192,128,0,0,0,60,15,3,193,243,252,255,63,239,251,225,248,126,31,135,225,240,124,0,
	0,0,15,3,224,248,126,159,255,255,255,255,255,254,31,135,225,248,126,31,135,193,128,0,0,64,60,15,3,224,251,254,255,191,239,251,224,248,62,31,135,225,240,124,0,
	0,48,15,131,225,248,126,31,255,255,255,255,255,255,255,135,225,248,126,31,135,193,128,0,0,240,62,15,131,224,255,255,255,255,255,255,193,240,124,31,7,193,240,124,0,
	0,62,15,131,224,248,126,31,255,255,255,255,255,255,255,135,225,248,126,31,135,192,0,0,0,248,62,15,131,224,255,255,255,255,255,255,225,240,124,31,7,193,240,124,0,
	0,62,15,131,224,248,62,15,255,255,255,255,255,255,255,7,193,240,124,31,7,192,0,3,224,248,62,15,131,224,248,63,255,255,255,255,255,240,124,31,7,193,240,124,0,
	8,62,31,135,225,248,126,31,255,255,255,255,255,255,255,7,193,240,124,31,7,192,0,3,224,248,62,15,131,224,248,127,255,255,255,255,255,240,124,31,7,193,240,56,0,
	56,62,31,135,225,248,126,31,255,255,255,255,255,255,255,135,225,248,124,31,7,192,0,3,224,248,62,15,131,224,248,127,255,255,255,255,255,240,124,31,7,193,240,8,0,
	120,62,31,135,225,248,126,31,255,255,255,255,255,255,255,135,225,248,124,31,3,192,1,3,224,248,126,31,135,225,248,127,255,255,255,255,255,240,120,30,7,129,224,0,0,
	248,62,31,135,225,248,126,31,255,255,255,255,255,255,255,135,225,248,124,31,1,128,3,3,225,240,124,31,7,193,240,125,255,127,223,247,253,240,120,30,7,129,224,0,0,
	240,62,63,143,227,248,254,63,255,255,255,255,255,255,255,135,225,248,124,31,1,128,7,3,193,240,124,31,7,193,240,253,255,127,223,247,253,240,120,30,7,128,224,0,0,
	240,62,63,143,227,248,254,63,191,255,255,255,255,255,255,151,225,248,124,15,0,128,7,3,193,240,124,31,7,193,240,252,255,63,207,243,252,240,56,14,3,128,96,0,0,
	240,126,63,143,227,248,254,63,191,255,255,255,255,255,255,167,225,248,124,15,0,0,14,3,129,224,248,62,15,131,224,248,254,63,143,227,248,240,48,12,3,0,64,0,0,
	240,126,63,143,227,248,254,63,159,239,251,254,255,191,239,195,240,252,60,15,0,0,12,3,1,192,240,60,15,3,192,240,252,63,15,195,240,240,48,12,3,0,64,0,0,
	248,126,63,143,227,248,254,63,159,239,251,254,255,191,239,195,240,252,60,7,0,0,8,2,1,128,224,56,14,3,128,224,120,30,7,129,224,112,16,4,1,0,0,0,0,
	248,126,63,143,227,248,254,63,159,239,251,254,255,191,239,227,240,252,63,7,0,0,8,6,1,128,224,56,14,3,128,224,120,30,7,129,224,112,16,4,1,0,0,0,0,
	248,254,63,159,231,249,254,127,159,231,249,254,127,159,231,225,240,124,31,7,0,0,0,4,3,0,192,48,12,3,0,192,112,28,7,1,192,112,20,4,0,0,0,0,0,
	248,254,63,159,231,249,254,127,159,231,249,254,127,159,231,225,240,124,31,7,0,0,15,7,195,240,252,63,15,195,240,252,63,15,195,240,252,60,15,3,192,192,0,0,0,
	248,254,127,159,231,249,254,127,159,231,249,254,127,159,231,241,240,124,31,7,0,0,15,15,195,240,252,63,15,195,240,252,63,15,195,240,252,60,15,3,192,192,0,0,0,
	241,252,127,31,199,241,252,127,31,199,241,252,127,31,199,241,248,126,31,7,0,0,14,31,135,225,248,126,15,131,224,248,62,15,131,224,248,60,15,3,192,192,0,0,0,
	243,252,255,63,207,243,252,255,63,207,243,252,255,63,207,225,248,126,31,7,0,0,14,31,135,225,248,126,31,135,225,248,126,31,135,225,248,124,15,3,192,192,0,0,0,
	227,248,254,63,143,227,248,254,63,143,227,248,254,63,143,227,248,126,31,135,0,0,14,63,143,227,248,254,63,143,227,248,254,63,143,227,248,252,15,3,192,192,0,0,0,
	199,241,252,127,31,199,241,252,127,31,199,241,252,127,159,227,248,62,15,131,0,0,12,63,15,195,240,252,63,15,195,240,252,63,15,195,240,252,15,3,192,208,0,0,0,
	199,241,252,127,31,199,241,252,127,159,231,249,254,127,159,225,248,62,15,131,0,0,8,126,31,135,225,248,126,31,135,225,248,126,31,135,225,252,15,3,192,208,0,0,0,
	135,241,252,127,31,199,241,252,127,159,231,249,254,127,159,225,248,62,15,131,0,0,0,124,31,7,193,240,124,31,7,193,240,124,31,7,193,252,15,3,192,208,0,0,0,
	135,241,252,127,31,199,241,252,127,159,231,249,254,127,159,225,248,62,15,129,0,0,0,124,31,7,193,240,124,31,7,193,240,124,31,7,193,252,15,3,192,208,0,0,0,
	135,241,252,127,31,199,241,252,127,223,247,253,255,127,223,241,252,63,15,129,0,0,0,56,30,7,129,224,120,30,7,129,224,120,30,7,129,236,7,1,192,80,0,0,0,
	135,241,252,127,31,199,241,254,127,223,247,253,255,127,223,241,252,63,15,129,64,0,0,48,28,7,1,192,112,28,7,1,192,112,28,7,1,204,7,1,192,80,0,0,0,
	7,241,252,127,31,199,241,254,127,223,247,253,255,127,223,240,252,63,15,129,64,0,0,32,24,6,1,128,96,24,6,1,128,96,24,6,0,140,7,1,192,112,0,0,0,
	7,225,252,127,31,199,241,254,127,255,255,255,255,255,255,250,126,31,135,193,64,0,0,32,8,6,1,128,96,24,6,1,128,96,24,6,0,140,7,1,192,80,0,0,0,
	7,241,252,127,31,199,241,255,255,255,255,255,255,255,255,250,126,31,135,225,96,0,0,0,0,4,1,0,64,16,4,1,0,64,16,4,0,8,6,1,128,96,0,0,0,
	7,225,248,126,31,135,225,255,255,255,255,255,255,255,255,248,126,31,135,225,224,0,0,32,8,0,0,0,0,0,0,0,0,0,0,0,32,24,2,0,128,32,0,0,0,
	7,161,248,126,31,135,225,255,255,255,255,255,255,255,255,248,126,31,135,224,240,0,0,0,15,3,192,240,60,15,3,254,255,191,239,251,254,159,131,224,248,62,0,0,0,
	7,33,248,126,31,135,225,255,255,255,255,255,255,255,255,248,126,31,135,224,248,0,0,0,31,7,193,240,124,31,7,255,255,255,255,255,254,31,131,224,248,62,0,0,0,
	4,33,248,126,31,135,225,255,255,255,255,255,255,255,255,248,126,31,135,224,248,0,0,0,31,7,193,240,124,31,7,255,255,255,255,255,254,15,131,224,248,62,0,0,0,
	0,1,240,124,31,7,193,255,255,255,255,255,255,255,255,248,62,15,131,224,248,0,0,0,31,7,193,240,124,31,7,255,255,255,255,255,255,255,131,224,248,62,15,128,0,
	0,1,240,124,31,7,193,255,255,255,255,255,255,255,255,248,126,31,135,225,248,66,0,0,14,7,193,240,124,31,255,255,255,255,255,255,254,15,131,224,248,62,15,128,0,
	0,1,240,124,31,135,225,255,255,255,255,255,255,255,255,248,126,31,135,225,248,78,0,0,6,7,193,240,124,31,255,255,255,255,255,255,254,31,131,224,248,62,15,128,0,
	0,0,240,126,31,135,225,255,255,255,255,255,255,255,255,248,126,31,135,225,248,94,0,0,2,7,129,224,120,30,255,255,255,255,255,255,254,31,135,225,248,126,31,132,32,
	0,0,96,126,31,135,225,255,255,255,255,255,255,255,255,248,126,31,135,225,248,126,0,0,2,7,129,224,120,30,247,253,255,127,223,247,252,31,7,193,240,124,31,4,64,
	0,0,96,126,31,135,229,255,255,255,255,255,255,255,255,248,254,63,143,227,248,254,0,0,0,3,129,224,120,30,247,253,255,127,223,247,252,31,7,193,240,124,31,4,192,
	0,0,96,126,31,135,233,255,255,255,255,255,255,255,239,248,254,63,143,227,248,252,0,0,0,3,128,224,56,14,243,252,255,63,207,243,252,63,7,193,240,124,31,5,192,
	0,0,8,62,31,135,249,255,255,255,255,255,255,255,231,248,254,63,143,227,248,252,16,0,0,1,0,192,48,12,227,120,254,63,143,227,248,62,15,131,224,248,62,5,128,
	0,0,8,63,15,195,248,255,191,239,251,254,255,191,231,248,254,63,143,227,248,252,16,0,0,1,0,192,48,12,195,240,252,63,15,195,240,60,15,3,192,240,60,7,0,
	0,0,8,31,15,195,240,255,191,239,251,254,255,191,231,248,254,63,143,227,248,254,16,0,0,0,0,64,48,12,129,224,120,30,7,129,224,56,14,3,128,224,56,6,0,
	0,0,8,31,15,195,248,255,191,239,251,254,255,191,231,248,254,63,143,227,248,254,48,0,0,0,0,64,16,4,129,224,120,30,7,129,224,56,14,3,128,224,56,6,1,
	0,0,12,31,7,193,248,127,159,231,249,254,127,159,231,249,254,127,159,231,248,254,48,0,0,0,0,64,16,5,1,192,112,28,7,1,192,48,12,3,0,192,48,4,1,
	0,0,12,31,7,193,248,127,159,231,249,254,127,159,231,249,254,127,159,231,248,254,48,0,0,0,48,60,15,3,240,252,63,15,195,240,252,63,15,195,240,252,63,15,193,
	0,0,12,31,7,193,252,127,159,231,249,254,127,159,231,249,254,127,159,231,249,254,48,0,0,0,48,60,15,3,240,252,63,15,195,240,252,63,15,195,240,252,63,15,195,
	0,0,14,31,135,225,252,127,31,199,241,252,127,31,199,241,252,127,31,199,241,252,112,0,0,0,48,60,15,3,224,248,62,15,131,224,248,62,15,131,224,248,62,15,131,
	0,0,14,15,135,225,248,127,63,207,243,252,255,63,207,243,252,255,63,207,243,252,240,0,0,0,48,60,15,3,225,248,126,31,135,225,248,126,31,135,225,248,126,31,135,
	0,0,14,15,135,225,248,254,63,143,227,248,254,63,143,227,248,254,63,143,227,248,240,0,0,64,48,60,15,3,227,248,254,63,143,227,248,254,63,143,227,248,254,63,143,
	0,0,14,15,131,224,248,252,127,31,199,241,252,127,31,199,241,252,127,31,199,241,240,0,0,192,48,60,15,3,195,240,252,63,15,195,240,252,63,15,195,240,252,63,15,
	0,0,14,15,131,224,248,126,127,159,231,249,254,127,31,199,241,252,127,31,199,241,240,0,0,192,48,60,15,3,135,225,248,126,31,135,225,248,126,31,135,225,248,126,31,
	0,0,14,15,131,224,248,126,127,159,231,249,254,127,159,199,241,252,127,31,199,241,240,0,0,192,48,60,15,3,71,193,240,124,31,7,193,240,124,31,7,193,240,124,31,
	0,0,14,15,131,224,248,126,127,159,231,249,254,127,31,199,241,252,127,31,199,225,240,0,0,192,48,60,15,3,71,193,240,124,31,7,193,240,124,31,7,193,240,124,15,
	0,16,14,7,195,240,252,127,127,223,247,253,255,127,31,199,241,252,127,31,199,225,240,0,0,192,48,28,7,1,71,129,224,120,30,7,129,224,120,30,7,129,224,120,14,
	0,16,14,7,195,240,252,127,127,223,247,253,255,127,31,199,241,252,127,31,199,225,240,0,0,192,48,28,7,1,7,1,192,112,28,7,1,192,112,28,7,1,192,112,12,
	0,16,15,7,195,240,252,191,127,223,247,253,255,127,31,199,241,252,127,31,199,193,240,0,0,192,48,28,7,1,6,1,128,96,24,6,1,128,96,24,6,1,128,96,8,
	0,0,15,7,225,248,126,31,255,255,255,255,255,255,31,199,241,252,127,31,199,193,240,0,0,192,48,28,7,1,130,1,128,96,24,6,1,128,96,24,6,1,128,32,8,
	0,24,15,135,225,248,126,31,255,255,255,255,255,255,255,199,241,252,127,31,199,193,240,0,0,0,32,24,6,1,128,1,0,64,16,4,1,0,64,16,4,1,0,0,0,
	0,56,15,131,225,248,126,31,255,255,255,255,255,255,255,135,225,248,126,31,135,193,240,0,0,128,32,8,2,0,128,64,0,0,0,0,0,0,0,0,0,0,0,0,0,
	0,60,15,131,225,248,126,31,255,255,255,255,255,255,255,135,225,248,126,31,135,193,224,0,0,248,62,15,131,224,250,62,255,191,239,251,224,240,60,15,3,192,240,60,0,
	0,62,15,131,225,248,126,31,255,255,255,255,255,255,255,135,225,248,126,31,135,193,192,0,0,248,62,15,131,224,248,63,255,255,255,255,193,240,124,31,7,193,240,124,0,
	0,62,15,131,225,248,126,31,255,255,255,255,255,255,255,135,225,248,126,31,135,193,0,1,0,248,62,15,131,224,248,63,255,255,255,255,193,240,124,31,7,193,240,124,0,
};

// Spinning cog animation. Accessed by holding LEFT when tuning power on. Users can scroll the Solder
// name left/right using buttons. Then the SPIN button will exit to game-of-life display. Using "SPIN"
// will restart the game-of-life with a random screen. "FAST DROP" will exit back to the main Tetris game.
const uint8_t cogSpinner[7380] PROGMEM={

	0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
	0,0,0,1,0,96,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,16,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
	0,0,0,1,0,0,24,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,16,0,1,128,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
	0,0,0,1,0,0,24,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,16,0,1,128,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,80,60,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,3,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,112,60,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,5,3,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,80,44,7,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,5,2,64,96,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,208,44,7,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,5,2,64,96,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,208,44,15,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,12,2,192,96,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,192,54,14,131,193,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,12,0,64,232,60,16,0,0,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,192,46,14,131,225,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,12,0,96,232,28,16,0,0,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,192,60,10,129,225,176,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,12,3,192,168,30,1,4,0,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,192,54,15,131,161,248,236,16,0,0,0,0,0,0,0,0,0,0,0,0,0,0,12,3,96,144,58,29,10,1,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,192,62,11,3,163,184,236,48,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8,3,224,144,42,25,10,193,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,128,48,15,129,160,232,238,49,132,0,0,0,0,0,0,0,0,0,0,0,0,0,8,1,0,160,26,6,138,194,16,64,0,0,0,0,0,0,0,0,
	0,0,0,0,0,128,20,15,129,160,232,254,57,4,0,0,0,0,0,0,0,0,0,0,0,0,0,8,1,64,168,26,6,138,194,16,64,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,16,31,132,224,224,254,127,140,3,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,248,70,6,13,166,168,192,32,0,0,0,0,0,0,0,
	0,0,0,0,0,192,16,31,132,224,225,254,127,156,3,0,0,0,0,0,0,0,0,0,0,0,0,4,1,1,248,6,6,13,166,168,192,48,0,0,0,0,0,0,0,
	0,0,0,0,0,0,48,31,135,225,96,248,127,158,231,0,64,0,0,0,0,0,0,0,0,0,0,0,3,1,112,126,22,11,131,153,38,112,4,0,0,0,0,0,0,
	0,0,0,0,0,128,48,29,135,224,224,56,63,158,227,0,0,0,0,0,0,0,0,0,0,0,0,8,3,1,88,110,6,1,131,217,14,48,0,0,0,0,0,0,0,
	0,0,0,0,0,128,48,21,143,193,120,56,127,23,226,57,64,0,0,0,0,0,0,0,0,0,0,8,3,1,88,248,21,131,135,225,126,3,144,0,0,0,0,0,0,
	0,0,0,0,0,128,48,21,143,225,120,56,127,23,236,57,64,32,0,0,0,0,0,0,0,0,0,8,3,1,88,120,21,131,131,225,126,3,144,2,0,0,0,0,0,
	0,0,0,0,0,128,48,20,15,99,120,88,118,63,237,187,206,112,0,0,0,0,0,0,0,0,0,0,3,1,64,230,51,133,132,99,182,90,52,7,0,0,0,0,0,
	0,0,0,0,0,128,48,20,15,99,120,92,78,63,229,251,202,240,0,0,0,0,0,0,0,0,0,0,3,1,64,230,51,133,132,227,182,94,148,39,0,0,0,0,0,
	0,0,0,0,0,0,32,28,15,227,232,86,6,29,239,255,111,250,188,0,0,0,0,0,0,0,0,0,2,1,192,246,62,133,64,97,152,233,230,206,9,192,0,0,0,
	0,0,0,0,0,0,32,28,15,99,232,92,7,25,239,223,77,250,152,4,0,0,0,0,0,0,0,0,2,1,192,242,62,133,64,97,152,233,228,206,9,128,0,0,0,
	0,0,0,0,0,0,32,28,15,35,248,254,39,27,221,115,111,159,252,110,0,128,0,0,0,0,0,0,2,1,192,242,41,7,96,97,57,151,38,249,31,192,96,0,0,
	0,0,0,0,0,0,32,60,31,39,248,254,39,31,155,247,111,145,252,70,0,128,0,0,0,0,0,0,2,1,192,242,47,15,224,97,120,151,102,233,31,196,96,0,0,
	0,0,0,0,0,0,96,24,31,38,249,250,55,131,223,247,255,190,245,255,19,192,0,0,0,0,0,0,0,1,128,242,47,143,162,88,60,126,29,89,174,71,240,40,0,
	0,0,0,0,0,0,80,28,15,6,248,218,23,135,207,241,255,190,254,255,3,192,0,0,0,0,0,0,0,1,128,240,107,140,161,80,24,246,29,89,174,78,240,20,0,
	0,0,0,0,0,0,16,92,31,38,217,252,119,133,197,230,255,191,139,223,63,192,80,0,0,0,0,0,0,1,192,240,104,143,199,120,92,78,47,219,88,45,178,232,4,
	0,0,0,0,0,0,0,124,15,14,248,252,127,141,212,242,253,191,130,255,46,227,112,0,0,0,0,0,0,1,192,240,109,142,199,120,92,78,45,219,88,45,178,232,4,
	0,0,0,0,0,0,0,28,15,14,209,174,126,143,116,119,125,223,255,251,251,195,224,0,0,0,0,0,0,1,192,240,237,26,103,40,54,7,119,221,212,223,11,60,62,
	0,0,0,0,0,0,32,12,31,15,241,182,126,139,224,115,125,255,239,251,59,239,224,0,0,0,0,0,0,0,192,240,237,26,103,168,180,7,51,221,212,223,1,60,58,
	0,0,0,0,0,0,32,24,15,15,193,182,255,141,226,247,29,255,127,247,127,231,240,0,0,0,0,0,2,0,128,240,252,19,111,224,214,15,81,223,246,247,54,204,109,
	0,0,0,0,0,0,32,40,15,143,193,190,255,13,224,245,157,255,255,247,254,199,208,0,0,0,0,0,2,2,128,240,252,19,111,240,214,15,73,222,247,247,54,204,109,
	0,0,0,0,0,0,0,40,15,15,203,190,255,159,229,93,61,239,127,243,249,255,176,0,0,0,0,0,0,2,128,240,252,19,111,144,250,5,131,222,115,253,61,141,211,
	0,0,0,0,0,0,32,40,15,143,193,62,255,157,229,88,60,239,127,243,249,255,176,0,0,0,0,0,0,2,128,240,252,19,239,145,218,21,131,206,115,245,63,141,147,
	0,0,0,0,0,0,0,40,30,15,227,63,239,159,229,120,63,239,123,255,219,255,240,0,0,0,0,0,0,2,128,224,252,19,12,249,218,85,129,210,247,157,221,142,163,
	0,0,0,0,0,0,0,44,63,7,203,186,239,158,227,216,30,159,125,255,248,255,112,0,0,0,0,0,0,0,66,224,124,51,44,185,202,61,129,200,247,157,197,141,163,
	0,0,0,0,0,0,0,16,47,15,199,251,206,191,207,248,246,135,127,206,253,254,240,0,0,0,0,0,0,0,2,240,120,55,172,171,236,190,139,104,114,188,167,85,99,
	0,0,0,0,0,0,0,0,63,15,199,254,202,191,207,120,182,135,123,206,127,254,240,0,0,0,0,0,0,0,3,240,120,119,172,139,236,182,139,104,114,60,167,83,99,
	0,0,0,0,0,0,0,0,63,15,199,243,206,191,255,169,190,15,161,223,246,247,112,0,0,0,0,0,0,0,2,112,248,127,12,203,255,250,155,96,210,29,255,107,101,
	0,0,0,0,0,0,0,0,55,15,199,242,205,191,255,249,182,15,51,223,247,150,80,0,0,0,0,0,0,0,3,112,124,127,12,219,255,250,153,96,210,29,207,105,101,
	0,0,0,0,0,0,0,0,62,15,199,241,221,246,255,249,254,93,167,249,243,255,112,0,0,0,0,0,0,0,3,64,124,126,29,223,103,255,29,164,218,62,135,31,246,
	0,0,0,0,0,0,0,8,55,151,231,240,221,247,255,121,254,205,179,252,243,255,224,0,0,0,0,0,0,0,1,64,124,126,13,215,119,247,29,160,216,62,199,31,246,
	0,0,0,0,0,0,0,8,54,7,199,241,221,119,127,123,250,223,131,108,255,61,240,0,0,0,0,0,0,0,129,32,124,127,13,135,119,247,189,169,88,52,79,113,223,
	0,0,0,0,0,0,0,8,18,15,231,241,221,119,127,123,250,247,131,244,247,125,240,0,0,0,0,0,0,0,129,32,124,127,13,135,119,241,191,169,88,52,79,117,223,
	0,0,0,0,0,0,0,72,18,31,231,249,220,103,223,223,254,191,175,228,255,126,208,0,0,0,0,0,0,0,1,32,120,127,157,134,109,253,189,203,104,22,15,23,204,
	0,0,0,0,0,0,0,0,27,31,135,241,254,246,191,255,255,127,139,112,255,190,208,0,0,0,0,0,0,0,0,177,248,127,29,230,105,251,252,214,232,151,7,83,205,
	0,0,0,0,0,0,0,32,11,30,199,241,254,119,191,191,255,127,155,96,220,63,224,0,0,0,0,0,0,0,0,129,236,126,31,230,115,218,254,215,105,182,5,195,254,
	0,0,0,0,0,0,0,0,15,31,199,225,252,103,255,255,255,247,147,96,220,63,224,0,0,0,0,0,0,0,0,129,236,126,31,198,123,218,254,215,105,54,13,195,222,
	0,0,0,0,0,0,0,0,72,31,199,241,248,103,185,239,255,255,55,228,220,127,16,0,0,0,0,0,0,0,0,129,172,126,31,134,123,152,255,255,179,26,77,199,112,
	0,0,0,0,0,0,0,0,12,31,231,241,252,103,185,239,254,255,63,169,252,127,0,0,0,0,0,0,0,0,0,65,188,127,31,134,115,156,253,239,243,90,13,199,112,
	0,0,0,0,0,0,0,0,76,31,167,249,248,103,57,255,247,255,189,169,248,127,144,0,0,0,0,0,0,0,0,1,176,127,31,134,115,159,253,127,115,218,149,131,113,
	0,0,0,0,0,0,0,0,32,15,71,249,252,103,25,255,247,255,255,233,248,63,144,0,0,0,0,0,0,0,0,0,176,63,31,198,97,157,254,127,115,218,149,131,121,
	0,0,0,0,0,0,0,8,96,27,135,249,252,110,25,223,247,247,255,251,120,55,144,0,0,0,0,0,0,0,0,0,144,63,31,198,97,29,239,127,127,253,182,129,96,
	0,0,0,0,0,0,0,0,2,15,131,249,254,110,25,222,247,243,255,247,120,54,144,0,0,0,0,0,0,0,0,32,208,62,31,230,97,25,111,127,63,253,54,129,96,
	0,0,0,0,0,0,0,0,50,15,135,225,254,127,19,151,255,255,255,222,236,150,0,0,0,0,0,0,0,0,0,32,200,62,31,230,241,24,111,255,223,253,110,137,96,
	0,0,0,0,0,0,0,0,16,28,199,225,252,127,155,214,235,255,254,223,251,118,80,0,0,0,0,0,0,0,0,0,76,126,31,134,249,28,110,191,191,236,110,147,96,
	0,0,0,0,0,0,0,0,0,6,199,241,248,127,153,238,233,255,254,255,251,58,80,0,0,0,0,0,0,0,0,0,72,122,31,135,241,30,70,31,255,238,246,51,161,
	0,0,0,0,0,0,0,0,0,6,199,177,248,127,27,236,251,255,255,255,123,58,16,0,0,0,0,0,0,0,0,0,96,123,31,135,225,30,198,31,255,238,246,51,161,
	0,0,0,0,0,0,0,0,0,6,199,177,252,126,19,230,251,252,255,255,255,251,144,0,0,0,0,0,0,0,0,0,96,123,31,199,225,60,71,187,143,255,251,101,168,
	0,0,0,0,0,0,0,0,0,6,7,185,252,127,19,204,251,250,255,255,255,219,128,0,0,0,0,0,0,0,0,0,32,123,31,199,225,60,71,187,143,223,247,101,184,
	0,0,0,0,0,0,0,0,0,19,7,249,254,127,27,132,243,255,253,255,255,221,144,0,0,0,0,0,0,0,0,0,32,88,31,199,225,56,71,51,207,215,255,253,145,
	0,0,0,0,0,0,0,0,2,27,135,209,254,127,147,196,247,63,253,127,255,223,176,0,0,0,0,0,0,0,0,1,48,124,31,199,241,56,71,51,239,199,255,253,147,
	0,0,0,0,0,0,0,0,2,19,7,193,254,127,159,196,227,61,255,255,255,255,240,0,0,0,0,0,0,0,0,1,0,108,31,199,249,248,78,51,223,247,245,251,210,
	0,0,0,0,0,0,0,0,0,17,135,193,250,127,159,228,227,63,255,255,191,253,96,0,0,0,0,0,0,0,0,1,0,108,31,135,249,124,78,19,223,247,241,251,198,
	0,0,0,0,0,0,0,0,96,25,135,65,240,127,159,228,241,59,127,127,223,255,224,0,0,0,0,0,0,0,0,1,8,100,31,7,249,254,14,3,149,247,253,255,206,
	0,0,0,0,0,0,0,0,0,28,131,177,248,126,31,228,248,61,126,255,191,254,240,0,0,0,0,0,0,0,0,0,192,50,31,135,225,254,15,131,133,239,251,254,204,
	0,0,0,0,0,0,0,0,48,12,131,177,248,126,31,196,249,62,111,223,255,255,240,0,0,0,0,0,0,0,0,0,192,50,31,135,225,248,15,131,228,233,255,254,253,
	0,0,0,0,0,0,0,0,0,6,3,177,252,126,31,132,249,62,239,31,255,255,240,0,0,0,0,0,0,0,0,0,64,50,30,199,225,248,15,131,228,225,247,255,255,
	0,0,0,0,0,0,0,0,16,6,3,161,252,127,31,135,240,62,143,159,111,255,240,0,0,0,0,0,0,0,0,0,64,24,30,199,241,248,79,3,224,249,246,253,255,
	0,0,0,0,0,0,0,0,0,7,1,145,236,127,159,132,240,62,207,191,255,255,240,0,0,0,0,0,0,0,0,0,0,24,30,199,241,248,78,3,200,251,244,253,255,
	0,0,0,0,0,0,0,0,0,4,3,129,238,127,159,199,225,60,143,191,255,255,240,0,0,0,0,0,0,0,0,0,0,24,30,7,241,252,94,3,192,251,252,253,127,
	0,0,0,0,0,0,0,0,0,19,3,193,244,127,159,229,240,60,207,127,255,223,240,0,0,0,0,0,0,0,0,0,0,8,30,7,241,252,94,3,128,243,124,253,127,
	0,0,0,0,0,0,0,0,0,0,4,193,240,127,31,231,240,120,159,127,255,247,240,0,0,0,0,0,0,0,0,0,0,12,31,7,193,254,127,3,128,242,125,255,63,
	0,0,0,0,0,0,0,0,0,0,4,193,240,127,159,231,249,120,206,247,223,247,240,0,0,0,0,0,0,0,0,0,0,68,27,7,193,254,127,3,128,226,125,255,127,
	0,0,0,0,0,0,0,0,0,16,4,225,184,124,31,231,249,126,30,7,191,247,240,0,0,0,0,0,0,0,0,0,0,64,19,7,193,252,127,135,192,224,121,255,127,
	0,0,0,0,0,0,0,0,0,24,6,33,216,126,31,135,240,126,31,135,167,255,240,0,0,0,0,0,0,0,0,0,0,98,24,135,225,248,127,7,224,240,120,126,255,
	0,0,0,0,0,0,0,0,0,24,6,1,204,127,31,135,224,126,31,135,231,207,240,0,0,0,0,0,0,0,0,0,0,96,28,135,225,248,126,7,224,248,120,124,223,
	0,0,0,0,0,0,0,0,0,0,3,1,204,127,31,135,224,124,31,135,231,239,240,0,0,0,0,0,0,0,0,0,0,48,28,135,177,248,126,7,192,248,124,124,159,
	0,0,0,0,0,0,0,0,0,8,3,1,200,127,31,199,224,252,31,135,229,249,240,0,0,0,0,0,0,0,0,0,0,48,12,7,49,252,126,7,128,248,62,30,31,
	0,0,0,0,0,0,0,0,0,0,1,128,228,123,159,199,240,252,31,7,239,251,240,0,0,0,0,0,0,0,0,0,0,16,12,7,177,252,126,7,128,240,62,31,159,
	0,0,0,0,0,0,0,0,0,0,1,129,224,121,31,231,241,248,30,7,255,251,240,0,0,0,0,0,0,0,0,0,0,16,6,7,129,236,127,31,129,224,60,159,191,
	0,0,0,0,0,0,0,0,0,0,1,192,224,122,159,231,249,248,31,39,235,251,240,0,0,0,0,0,0,0,0,0,0,0,6,7,129,236,127,31,129,224,124,159,191,
	0,0,0,0,0,0,0,0,0,0,0,128,240,124,30,231,249,254,63,7,137,247,240,0,0,0,0,0,0,0,0,0,0,0,6,7,129,224,127,159,193,224,120,31,127,
	0,0,0,0,0,0,0,0,0,0,0,0,240,124,31,103,249,254,31,7,137,255,240,0,0,0,0,0,0,0,0,0,0,0,3,7,193,240,127,159,225,224,120,30,127,
	0,0,0,0,0,0,0,0,0,16,4,1,56,124,31,7,249,254,63,135,129,239,240,0,0,0,0,0,0,0,0,0,0,0,1,7,193,240,127,31,225,248,120,30,47,
	0,0,0,0,0,0,0,0,0,8,6,1,136,127,31,135,193,252,127,135,225,253,240,0,0,0,0,0,0,0,0,0,0,64,24,134,97,248,124,31,129,248,126,30,15,
	0,0,0,0,0,0,0,0,0,24,7,1,200,115,31,199,225,248,127,7,225,248,240,0,0,0,0,0,0,0,0,0,0,96,24,6,49,248,126,31,131,240,126,31,135,
	0,0,0,0,0,0,0,0,0,16,6,1,192,115,31,199,225,248,126,135,225,248,240,0,0,0,0,0,0,0,0,0,0,64,24,7,49,252,126,31,131,224,126,31,135,
	0,0,0,0,0,0,0,0,0,0,0,1,192,113,29,199,241,248,127,7,193,248,112,0,0,0,0,0,0,0,0,0,0,0,28,7,1,204,127,31,135,224,124,31,135,
	0,0,0,0,0,0,0,0,0,0,0,1,192,113,28,231,241,252,126,7,193,248,112,0,0,0,0,0,0,0,0,0,0,0,12,7,1,204,127,31,135,224,120,31,135,
	0,0,0,0,0,0,0,0,0,0,0,0,224,120,30,199,185,252,126,15,131,240,240,0,0,0,0,0,0,0,0,0,0,0,12,3,1,192,123,31,199,224,120,30,7,
	0,0,0,0,0,0,0,0,0,0,0,0,96,120,30,167,249,254,127,15,131,240,112,0,0,0,0,0,0,0,0,0,0,0,6,3,129,224,123,31,231,240,248,30,7,
	0,0,0,0,0,0,0,0,0,0,0,0,96,56,30,7,129,254,127,159,193,224,240,0,0,0,0,0,0,0,0,0,0,0,0,3,129,224,120,31,231,240,248,30,7,
	0,0,0,0,0,0,0,0,0,0,0,0,32,60,31,7,193,254,127,159,193,224,240,0,0,0,0,0,0,0,0,0,0,0,0,1,193,224,120,31,231,248,252,30,7,
	0,0,0,0,0,0,0,0,0,0,0,0,0,110,31,7,193,254,127,159,225,240,112,0,0,0,0,0,0,0,0,0,0,0,0,0,193,240,124,31,199,248,254,30,7,
	0,0,0,0,0,0,0,0,0,0,4,1,0,66,31,135,225,248,127,31,225,248,112,0,0,0,0,0,0,0,0,0,0,0,16,4,33,184,126,31,7,224,254,31,135,
	4,1,128,96,24,0,0,0,96,24,0,1,0,99,29,199,225,248,126,15,225,248,240,64,24,6,1,128,0,0,6,1,128,0,16,6,33,152,126,31,7,224,252,31,135,
	6,1,192,112,28,4,0,0,112,28,4,1,128,98,31,199,241,252,126,15,225,248,240,96,28,7,1,192,64,0,7,1,192,64,24,6,1,140,126,31,135,224,248,31,135,
	7,0,224,56,30,6,0,0,56,30,6,1,192,113,29,199,241,252,126,15,193,248,240,112,14,3,129,224,96,0,3,129,224,96,24,7,1,204,127,31,135,224,248,31,7,
	7,128,112,28,31,7,0,0,28,31,7,0,192,121,30,199,249,252,126,15,193,240,240,120,7,1,193,240,112,0,1,193,240,112,12,7,1,204,123,31,199,224,248,31,7,
	7,225,56,14,31,7,129,8,78,31,7,128,192,112,30,135,185,254,127,31,129,224,240,126,19,128,225,240,120,16,132,225,240,120,12,3,1,192,123,31,199,224,248,30,7,
	135,241,156,7,15,7,193,140,103,31,3,192,240,60,31,71,185,254,127,159,193,224,248,127,25,192,112,240,124,24,198,113,240,60,4,3,129,224,123,31,231,240,248,30,7,
	195,249,206,3,135,131,193,206,115,143,129,192,96,56,30,7,129,254,127,159,193,224,252,63,156,224,56,120,60,28,231,56,248,28,0,3,129,224,120,31,231,240,248,30,7,
	225,220,231,3,195,193,192,231,59,199,192,192,32,60,31,7,193,254,127,159,193,224,254,29,206,112,60,60,28,14,115,188,124,12,0,1,193,224,120,31,231,248,252,30,7,
	240,206,115,131,241,228,193,115,223,243,224,64,0,110,31,7,193,254,127,159,225,240,127,12,231,56,63,30,76,23,61,255,62,4,0,0,193,240,124,31,199,248,254,30,7,
	248,102,49,195,248,246,97,185,239,249,244,1,0,66,31,135,225,248,127,31,225,248,127,134,99,28,63,143,102,11,158,255,159,64,16,4,33,184,126,31,7,224,254,31,135,
	248,50,16,225,252,251,48,220,183,252,126,1,0,99,29,199,225,248,126,15,225,248,255,131,33,14,31,207,179,5,203,127,199,224,16,6,33,152,126,31,7,224,252,31,135,
	120,56,0,112,254,121,184,110,25,254,63,1,128,98,31,199,241,252,126,15,225,248,247,131,128,7,15,231,155,130,225,159,227,240,24,6,1,140,126,31,135,224,248,31,135,
	56,28,0,120,127,60,221,55,76,255,31,129,192,113,29,199,241,252,126,15,193,248,243,129,192,7,135,243,205,193,116,207,241,248,24,7,1,204,127,31,135,224,248,31,7,
	24,14,0,62,63,158,111,155,230,127,11,192,192,121,30,199,249,252,126,15,193,240,241,128,224,3,227,249,230,240,190,103,240,188,12,7,1,204,123,31,199,224,248,31,7,
	8,6,8,31,15,203,55,205,179,47,129,192,192,112,30,135,185,254,127,31,129,224,240,128,96,129,240,252,177,120,219,50,248,28,12,3,1,192,123,31,199,224,248,30,7,
	0,2,12,15,135,97,154,230,155,135,192,192,240,60,31,71,185,254,127,159,193,224,240,0,32,192,248,118,24,172,105,184,124,12,4,3,129,224,123,31,231,240,248,30,7,
	4,1,14,71,211,52,205,115,79,211,228,64,96,56,30,7,129,254,127,159,193,224,240,64,16,228,125,51,76,86,52,253,62,68,0,3,129,224,120,31,231,240,248,30,7,
	6,1,143,99,249,158,103,185,231,249,246,0,32,60,31,7,193,254,127,159,193,224,240,96,24,246,63,153,228,59,158,127,159,96,0,1,193,224,120,31,231,248,252,30,7,
	3,0,199,179,236,203,50,220,179,236,123,0,0,110,31,7,193,254,127,159,225,240,112,48,12,123,62,204,178,13,203,62,199,176,0,0,193,240,124,31,199,248,254,30,7,
	1,128,99,153,230,101,185,102,89,230,57,129,0,66,31,135,225,248,127,31,225,248,112,24,6,57,158,102,91,22,101,158,99,152,16,4,33,184,126,31,7,224,254,31,135,
	0,192,49,140,243,54,221,179,108,243,24,193,0,99,29,199,225,248,126,15,225,248,240,12,3,24,207,51,109,155,54,207,49,140,16,6,33,152,126,31,7,224,252,31,135,
	128,96,24,198,121,159,110,217,246,121,140,65,128,98,31,199,241,252,126,15,225,248,248,6,1,140,103,153,246,205,159,103,152,196,24,6,1,140,126,31,135,224,248,31,135,
	192,48,12,99,60,203,182,108,187,60,198,1,192,113,29,199,241,252,126,15,193,248,252,3,0,198,51,204,187,102,203,179,204,96,24,7,1,204,127,31,135,224,248,31,7,
	96,24,6,49,158,101,218,54,93,158,99,0,192,121,30,199,249,252,126,15,193,240,246,1,128,99,25,230,93,163,101,217,230,48,12,7,1,204,123,31,199,224,248,31,7,
	52,13,3,88,223,182,237,27,108,223,53,128,192,112,30,135,185,254,127,31,129,224,243,64,208,53,141,251,110,209,182,205,243,88,12,3,1,192,123,31,199,224,248,30,7,
	30,7,129,238,127,223,119,141,246,127,30,192,240,60,31,71,185,254,127,159,193,224,241,224,120,30,231,253,247,120,223,103,241,236,4,3,129,224,123,31,231,240,248,30,7,
	11,2,200,183,47,235,154,206,187,47,139,64,96,56,30,7,129,254,127,159,193,224,240,176,44,139,114,254,185,172,235,178,248,180,0,3,129,224,120,31,231,240,248,30,7,
	1,128,108,27,135,117,205,103,95,135,193,128,32,60,31,7,193,254,127,159,193,224,240,24,6,193,184,119,92,214,117,248,124,24,0,1,193,224,120,31,231,248,252,30,7,
	0,192,54,15,211,190,199,187,239,211,96,192,0,110,31,7,193,254,127,159,225,240,112,12,3,96,253,59,236,123,190,253,54,12,0,0,193,240,124,31,199,248,254,30,7,
	128,96,27,71,249,223,99,221,247,249,180,65,0,66,31,135,225,248,127,31,225,248,120,6,1,180,127,157,246,61,223,127,155,68,16,4,33,184,126,31,7,224,254,31,135,
	192,48,13,227,236,235,177,238,187,252,222,1,0,99,29,199,225,248,126,15,225,248,252,3,0,222,62,206,187,30,235,191,205,224,16,6,33,152,126,31,7,224,252,31,135,
	96,24,6,241,246,113,217,247,29,254,111,1,128,98,31,199,241,252,126,15,225,248,246,1,128,111,31,103,29,159,113,223,230,240,24,6,1,140,126,31,135,224,248,31,135,
	48,12,3,120,251,188,237,251,140,255,55,129,192,113,29,199,241,252,126,15,193,248,243,0,192,55,143,187,206,223,184,207,243,120,24,7,1,204,127,31,135,224,248,31,7,
	24,6,1,190,125,222,119,253,134,127,27,192,192,121,30,199,249,252,126,15,193,240,241,128,96,27,231,221,231,127,216,103,241,188,12,7,1,204,123,31,199,224,248,31,7,
	8,2,8,159,46,235,58,254,131,47,137,192,192,112,30,135,185,254,127,31,129,224,240,128,32,137,242,238,179,175,232,50,248,156,12,3,1,192,123,31,199,224,248,30,7,
	0,0,12,77,151,117,189,119,67,151,196,192,240,60,31,71,185,254,127,159,193,224,240,0,0,196,217,119,91,215,116,57,124,76,4,3,129,224,123,31,231,240,248,30,7,
	0,0,14,102,219,62,255,179,227,219,230,64,96,56,30,7,129,254,127,159,193,224,240,0,0,230,109,179,239,251,62,61,190,100,0,3,129,224,120,31,231,240,248,30,7,
	0,0,15,51,125,159,126,209,179,237,243,0,32,60,31,7,193,254,127,159,193,224,240,0,0,243,55,217,247,237,27,62,223,48,0,1,193,224,120,31,231,248,252,30,7,
	0,0,7,219,190,203,190,96,155,230,121,128,0,110,31,7,193,254,127,159,225,240,112,0,0,125,187,236,187,230,9,190,103,152,0,0,193,240,124,31,199,248,254,30,7,
	0,0,3,237,223,97,222,48,13,227,56,193,0,66,31,135,225,248,127,31,225,248,112,0,0,62,221,246,29,227,0,222,51,140,16,4,33,184,126,31,7,224,254,31,135,
	0,0,9,182,239,176,238,24,6,225,156,65,0,99,29,199,225,248,126,15,225,248,240,0,0,155,110,251,14,225,128,110,25,132,16,6,33,152,126,31,7,224,252,31,135,
	0,0,12,155,103,216,118,12,3,96,204,1,128,98,31,199,241,252,126,15,225,248,240,0,0,201,182,125,135,96,192,54,12,128,24,6,1,140,126,31,135,224,248,31,135,
	0,0,6,15,163,232,26,6,1,160,96,1,192,113,29,199,241,252,126,15,193,248,240,0,0,96,250,62,129,160,96,26,6,0,24,7,1,204,127,31,135,224,248,31,7,
	0,0,11,7,193,112,12,3,0,192,48,0,192,121,30,199,249,252,126,15,193,240,240,0,0,176,124,23,0,192,48,12,3,0,12,7,1,204,123,31,199,224,248,31,7,
	0,0,13,131,224,56,6,1,128,96,24,0,192,112,30,135,185,254,127,31,129,224,240,0,0,216,62,3,128,96,24,6,1,128,12,3,1,192,123,31,199,224,248,30,7,
	0,0,6,129,224,24,2,0,128,32,8,0,240,60,31,71,185,254,127,159,193,224,240,0,0,104,30,1,128,32,8,2,0,128,4,3,129,224,123,31,231,240,248,30,7,
	0,0,3,0,224,8,0,0,0,0,0,0,96,56,30,7,129,254,127,159,193,224,240,0,0,48,14,0,128,0,0,0,0,0,0,3,129,224,120,31,231,240,248,30,7,
	0,0,1,128,96,0,0,0,0,0,0,0,32,60,31,7,193,254,127,159,193,224,240,0,0,24,6,0,0,0,0,0,0,0,0,1,193,224,120,31,231,248,252,30,7,
	0,0,0,128,32,0,0,0,0,0,0,0,0,110,31,7,193,254,127,159,225,240,112,0,0,8,2,0,0,0,0,0,0,0,0,0,193,240,124,31,199,248,254,30,7,
	0,0,0,0,0,0,0,0,0,0,4,1,0,66,31,135,225,248,127,31,225,248,112,0,0,0,0,0,0,0,0,0,0,0,16,4,33,184,126,31,7,224,254,31,135,
	0,0,0,0,0,0,0,0,0,0,0,1,128,98,24,199,225,248,126,31,135,248,240,0,0,0,0,0,0,0,0,0,0,0,16,4,33,8,126,31,135,193,248,63,143,
	0,0,0,0,0,0,0,0,0,0,4,1,128,96,24,135,113,252,126,31,135,252,240,0,0,0,0,0,0,0,0,0,0,0,0,4,1,136,99,31,135,225,248,126,15,
	0,0,0,0,0,0,0,0,0,0,0,0,0,96,28,135,49,220,127,31,199,225,240,0,0,0,0,0,0,0,0,0,0,0,0,4,1,128,98,28,199,241,248,124,31,
	0,0,0,0,0,0,0,0,0,0,0,0,0,96,24,7,49,141,127,159,199,241,240,0,0,0,0,0,0,0,0,0,0,0,0,6,1,128,96,24,199,113,252,126,31,
	0,0,0,0,0,0,0,0,0,0,0,0,0,112,24,6,1,192,115,223,231,253,240,0,0,0,0,0,0,0,0,0,0,0,0,4,1,128,96,24,6,49,206,127,31,
	0,0,0,0,0,0,0,0,0,0,0,0,0,104,30,7,129,224,112,92,231,249,240,0,0,0,0,0,0,0,0,0,0,0,0,0,1,192,112,28,7,1,204,127,159,
	0,0,0,0,0,0,0,0,0,0,0,0,0,0,8,7,129,224,120,28,7,189,240,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,112,28,7,1,192,112,30,
	0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,3,1,224,120,30,7,129,224,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,32,30,7,1,192,112,30,
	0,0,0,0,0,0,0,0,0,0,0,0,0,0,12,1,1,232,120,30,7,129,224,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,7,129,224,120,30,
	0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,72,30,31,135,225,240,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,120,124,31,
	0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,1,199,241,240,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,30,31,
	0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,193,241,240,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,23,
	0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,16,4,49,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,25,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
};


// Used in version one boards with a hardware on/off button to wake from sleep. This was a stupid idea
// in practice, as it mean the card was constantly being activated while in a wallet. So a slide switch
// was added in the next iteration.
ISR (INT0_vect){
}

// Swaps between fast and slow modes. Fast mode allows more CPU time outside of the LED updates,
// but can only have 1 brightness. Slow mode allows 2 brightnesses, but leaves less time for other
// processing. The Tetris game uses slow mode, as the player's current piece is shown brighter than
// the rest of the grid.
void setVideoMode(uint8_t mode){
	videoMode=mode;
	cli();
	//set timer1 interrupt at 1kHz
	TCCR1A = 0;// set entire TCCR1A register to 0
	TCCR1B = 0;// same for TCCR1B
	TCNT1  = 0;//initialize counter value to 0
	switch(mode){
		case VIDEO_MODE_FAST:
		OCR1A = TIMER_SPEED_FAST;// = (16*10^6) / (1000*8) - 1
		break;
		
		case VIDEO_MODE_SLOW:
		OCR1A = TIMER_SPEED_SLOW;// = (16*10^6) / (1000*8) - 1
		break;
	}	
	TCCR1B |= (1 << WGM12);
	// Set CS11 bit for 8 prescaler
	TCCR1B |= (1 << CS11);
	// enable timer compare interrupt
	TIMSK1 |= (1 << OCIE1A);
	sei();
}

// Only used in V1 boards. Newer boards use slide switch to enable power.
void goToSleep(void){
	/*
	DDRE=0;
	DDRB=0;
	DDRD=0;
	DDRC=0;
	
	PORTE=0x0f;
	PORTB=0xff;
	PORTD=0xff;
	PORTC=0xff;
	
	ADCSRA=0;
	power_all_disable ();
	*/
	cli();
	
	wdt_reset();
	/* Clear WDRF in MCUSR */
	MCUSR &= ~(1<<WDRF);
	/* Turn off WDT */
	WDTCSR = 0x00;
	
	// Disable brownout detection
	MCUCR = (1<<BODS) | (1<<BODSE);

	EICRA=0;			// LOW level interrupt
	EIMSK|=(1<<INT0);	// D2
	SREG|=(1<<7);		// Enable external interrupt
	
	set_sleep_mode(SLEEP_MODE_PWR_DOWN);
	sleep_enable();
	sleep_mode();
	sei();
	sleep_disable();
	EIMSK=0;
	
	while(getButtonState()){
		if(!butPressed(BUTTON_ON_OFF)){
			break;
		}
	}
	
}

// Used by matrix update timer to select the correct column driver pin, and polarity.
// The card only ever drives a maximum of 5 LEDs at a time, so uses very little power.
// Optimized for speed over size.
// In case you're wondering why the GPIO pin to row association seems so random, it's
// actually so that the board layout could have as few visible vias as possible, except
// for within the LED array where it's unavoidable on a 2 layer board. It's a business
// card, so function follows form to some extent!
void selectCol(void){
	
	// First disable all columns to prevent ghosting
	DDRE=0;
	DDRB&=~0b11100000;
	DDRD&=0;
	DDRC&=~0b001111;
	
	PORTE=0;
	PORTB&=~0b11100000;
	PORTD&=0;
	PORTC&=~0b001111;
	
	// Enable the correct column driver pin - note that we are driving both anodes and cathodes, 
	// so each row pin drives 2 columns
	switch(currentCol){

	case 36:
		PORTD&=~(1<<2);
		DDRD|=(1<<2);
		break;
	case 34:
		PORTB&=~(1<<6);
		DDRB|=(1<<6);
		break;
	case 32:
		PORTB|=(1<<6);
		DDRB|=(1<<6);
		break;
	case 30:
		PORTE&=~(1<<0);
		DDRE|=(1<<0);
		break;
	case 28:
		PORTE|=(1<<0);
		DDRE|=(1<<0);
		break;
	case 26:
		PORTD&=~(1<<3);
		DDRD|=(1<<3);
		break;
	case 24:
		PORTD|=(1<<3);
		DDRD|=(1<<3);
		break;
	case 22:
		PORTC&=~(1<<3);
		DDRC|=(1<<3);
		break;
	case 20:
		PORTC|=(1<<3);
		DDRC|=(1<<3);
		break;
	case 18:
		PORTD&=~(1<<5);
		DDRD|=(1<<5);
		break;
	case 16:
		PORTD|=(1<<5);
		DDRD|=(1<<5);
		break;
	case 14:
		PORTD&=~(1<<6);
		DDRD|=(1<<6);
		break;
	case 12:
		PORTD|=(1<<6);
		DDRD|=(1<<6);
		break;
	case 10:
		PORTD&=~(1<<7);
		DDRD|=(1<<7);
		break;
	case 8:
		PORTD|=(1<<7);
		DDRD|=(1<<7);
		break;
	case 6:
		PORTC&=~(1<<0);
		DDRC|=(1<<0);
		break;
	case 4:
		PORTC|=(1<<0);
		DDRC|=(1<<0);
		break;
	case 2:
		PORTB&=~(1<<5);
		DDRB|=(1<<5);
		break;
	case 0:
		PORTB|=(1<<5);
		DDRB|=(1<<5);
		break;


	case 37:
		PORTD|=(1<<2);
		DDRD|=(1<<2);
		break;
	case 35:
		PORTB&=~(1<<7);
		DDRB|=(1<<7);
		break;
	case 33:
		PORTB|=(1<<7);
		DDRB|=(1<<7);
		break;
	case 31:
		PORTE&=~(1<<1);
		DDRE|=(1<<1);
		break;
	case 29:
		PORTE|=(1<<1);
		DDRE|=(1<<1);
		break;
	case 27:
		PORTD&=~(1<<4);
		DDRD|=(1<<4);
		break;
	case 25:
		PORTD|=(1<<4);
		DDRD|=(1<<4);
		break;
	case 23:
		PORTD&=~(1<<1);
		DDRD|=(1<<1);
		break;
	case 21:
		PORTD|=(1<<1);
		DDRD|=(1<<1);
		break;
	case 19:
		PORTC&=~(1<<2);
		DDRC|=(1<<2);
		break;
	case 17:
		PORTC|=(1<<2);
		DDRC|=(1<<2);
		break;
	case 15:
		PORTC&=~(1<<1);
		DDRC|=(1<<1);
		break;
	case 13:
		PORTC|=(1<<1);
		DDRC|=(1<<1);
		break;
	case 11:
		PORTE&=~(1<<3);
		DDRE|=(1<<3);
		break;
	case 9:
		PORTE|=(1<<3);
		DDRE|=(1<<3);
		break;
	case 7:
		PORTE&=~(1<<2);
		DDRE|=(1<<2);
		break;
	case 5:
		PORTE|=(1<<2);
		DDRE|=(1<<2);
		break;
	case 3:
		PORTD&=~(1<<0);
		DDRD|=(1<<0);
		break;
	case 1:
		PORTD|=(1<<0);
		DDRD|=(1<<0);
		break;
	}
}

// Display update timer interrupt - selects the next row of 5 LEDs and displays the correct
// bitmap. If in SLOW mode, this is repeated for both planes. In FAST mode, only the first plane
// is used, and the timer speed reduced to allow more CPU processing time.
ISR(TIMER1_COMPA_vect) {
	if(++currentCol==MAX_COL){
		currentCol=0;
		if(switchBuffer){
			if(activeBuffer==1){
				activeBuffer=0;
				drawBuffer=1;
			}else{
				activeBuffer=1;
				drawBuffer=0;
			}
			switchBuffer=0;
		}
		if(videoMode==VIDEO_MODE_SLOW){
			if(++cBit>2)
				cBit=0;
			buffOff=(cBit<2?MAX_COL:0);
		}else{
			buffOff=0;
		}
	}
	DDRB=0;
	if((currentCol&2)||(currentCol==MAX_COL-2)){
		PORTB=buffer[activeBuffer][currentCol+buffOff];;
	}else{
		PORTB=~buffer[activeBuffer][currentCol+buffOff];;
	}
	selectCol();
	DDRB|=0b11111;
	
}

// Bare minimum setup at power on
 void setup(void){ 
	setVideoMode(VIDEO_MODE_SLOW);
	#if VER==1
	DDRD&=~(1<<BUT_ON_OFF);
	#endif 
}
 
 // Clear the current draw buffer
 void clearBuffer(void){
	for(uint8_t n=0;n<MAX_COL*2;n++){
		buffer[drawBuffer][n]=0;
	}
 }
 
 // Requests a buffer swap and waits until the LED driver interrupt has finished the current frame, 
 // and changes buffers to ensure we don't update a buffer that's being drawn, causing glitches.
 void flipBuffers(void){
	 switchBuffer=1;
	 while(switchBuffer);
 }
 
 // Just copies the contents of the active buffer back into the draw buffer
 void copyToBackBuffer(void){
	 for(uint8_t n=0;n<MAX_COL*2;n++){
		 buffer[drawBuffer][n]=buffer[activeBuffer][n];
	 }
 }
 
 // Loads raw data into both planes of the current draw buffer. Used by Tetris game to update
 // the display of the grid and overlay the player's piece
 void loadBuffer(uint8_t *data){
	 for(uint8_t n=0;n<MAX_COL*2;n++){
		 buffer[drawBuffer][n]=data[n];
	 }
 }

// Loads a frame of compressed data from program memory.
// A frame is 45 bytes in length.
 void displayVideoFrame(const uint8_t *data, uint16_t frameIX){
	 uint8_t bitPos=0;
	 uint8_t ix=0,ix2=0;
	 data+=(BYTES_PER_FRAME*frameIX);
 	 while(ix2<BYTES_PER_FRAME){
		uint8_t b=pgm_read_byte(data+ix2);
	
		switch(bitPos){
			case 0:
				break;
			case 1:
				b<<=1;
				break;
			case 2:
				b<<=2;
				break;
			case 3:
				b<<=3;
				break;
			case 4:
				b<<=4;
				b|=pgm_read_byte(data+ix2+1)>>4;
				break;
			case 5:
				b<<=5;
				b|=pgm_read_byte(data+ix2+1)>>3;
				break;
			case 6:
				b<<=6;
				b|=pgm_read_byte(data+ix2+1)>>2;
				break;
			case 7:
				b<<=7;
				b|=pgm_read_byte(data+ix2+1)>>1;
				break;
		}
		
		buffer[drawBuffer][ix]=b>>3;

		if(++ix==36)
			ix+=2;
			
		bitPos+=5;
		if(bitPos>7){
			bitPos-=8;
			++ix2;
		}
		  
 	 }
 }

// Returns 1 if the pixel at x,y in the active buffer is on
uint8_t getActive(int8_t x,int8_t y){
	uint8_t ret=0;
	if(x>9)
		x-=10;
	else if(x<0)
		x+=10;
	if(y>17)
		y-=18;
	else if(y<0)
		y+=18;
		
	y<<=1;
	if(x<5){
		ret=( (buffer[activeBuffer][y]&(1<<x)) ? 1 : 0 );
	}else{
		ret=( (buffer[activeBuffer][y+1]&(1<<(x-5))) ? 1: 0);
	}
	return ret;
}

// Returns 1 if the pixel at x,y in the draw buffer is on
uint8_t getDraw(int8_t x,int8_t y){
	uint8_t ret=0;
	if(x>9)
		x-=10;
	else if(x<0)
		x+=10;
	if(y>17)
		y-=18;
	else if(y<0)
		y+=18;
	y<<=1;
	if(x<5){
		ret=( (buffer[drawBuffer][y]&(1<<x)) ? 1 : 0 );
	}else{
		ret=( (buffer[drawBuffer][y+1]&(1<<(x-5))) ? 1: 0);
	}
	return ret;
}

// Plot pixel of brightness 0,1, or 2 in active buffer
void plotActive(int8_t x, int8_t y, uint8_t c){
	if(x>9 || x<0 || y<0 || y>17)
		return;
	y<<=1;
	switch(c){
		case 0:
			if(x<5){
				buffer[activeBuffer][y]&=~(1<<x);
				buffer[activeBuffer][y+MAX_COL]&=~(1<<x);
			}else{
				buffer[activeBuffer][y+1]&=~(1<<(x-5));
				buffer[activeBuffer][y+1+MAX_COL]&=~(1<<(x-5));
			}
			break;
		case 1:
			if(x<5){
				buffer[activeBuffer][y]|=(1<<x);
				buffer[activeBuffer][y+MAX_COL]&=~(1<<x);
			}else{
				buffer[activeBuffer][y+1]|=(1<<(x-5));
				buffer[activeBuffer][y+1+MAX_COL]&=~(1<<(x-5));
			}
			break;
		case 2:
			if(x<5){
				buffer[activeBuffer][y]|=(1<<x);
				buffer[activeBuffer][y+MAX_COL]|=(1<<x);
			}else{
				buffer[activeBuffer][y+1]|=(1<<(x-5));
				buffer[activeBuffer][y+1+MAX_COL]|=(1<<(x-5));
			}
			break;
	}
}

// Plot pixel of brightness 0,1, or 2 in draw buffer
void plot(int8_t x, int8_t y, uint8_t c){
	if(x>9 || x<0 || y<0 || y>17)
	return;
	y<<=1;
	switch(c){
		case 0:
		if(x<5){
			buffer[drawBuffer][y]&=~(1<<x);
			buffer[drawBuffer][y+MAX_COL]&=~(1<<x);
			}else{
			buffer[drawBuffer][y+1]&=~(1<<(x-5));
			buffer[drawBuffer][y+1+MAX_COL]&=~(1<<(x-5));
		}
		break;
		case 1:
		if(x<5){
			buffer[drawBuffer][y]|=(1<<x);
			buffer[drawBuffer][y+MAX_COL]&=~(1<<x);
			}else{
			buffer[drawBuffer][y+1]|=(1<<(x-5));
			buffer[drawBuffer][y+1+MAX_COL]&=~(1<<(x-5));
		}
		break;
		case 2:
		if(x<5){
			buffer[drawBuffer][y]|=(1<<x);
			buffer[drawBuffer][y+MAX_COL]|=(1<<x);
			}else{
			buffer[drawBuffer][y+1]|=(1<<(x-5));
			buffer[drawBuffer][y+1+MAX_COL]|=(1<<(x-5));
		}
		break;
	}
}

// Plot pixel at x,y in draw buffer if dOff is 3. Used by the initial rotating border animation/
void doPlot(int8_t x,int8_t y,uint8_t *dOdd){
	if(*dOdd==3){
		plot(x,y,0);
	}else{
		plot(x,y,2);
	}
	if(++*dOdd==4){
		*dOdd=0;
	}
}

// Draws the rotating border animation at zoom level "amp".
void drawSpinner(uint8_t dotOff, uint8_t amp){
	amp=5-amp;
	uint8_t dOdd=dotOff;
	for(uint8_t n=0+amp;n<10-amp;n++){
		doPlot(n,0+amp,&dOdd);
	}
	for(uint8_t n=1+amp;n<18-amp;n++){
		doPlot(9-amp,n,&dOdd);
	}
	for(int8_t n=8-amp;n>-1+amp;n--){
		doPlot(n,17-amp,&dOdd);
	}
	for(int8_t n=16-amp;n>0+amp;n--){
		doPlot(0+amp,n,&dOdd);
	}
}

// Draw a vertical or horizontal line in brightness 0,1, or 2
void drawLine(int8_t x, int8_t y, int8_t w, int8_t h, uint8_t c){
	if(w>0){
		for(int8_t n=0;n<w;n++){
			plot(x+n,y,c);
		}
	}else{
		for(int8_t n=0;n<h;n++){
			plot(x,y+n,c);
		}
	}
}

// Draws a solid block of brightness 0,1, or 2
void drawBlock(int8_t x, int8_t y, int8_t w, int8_t h, uint8_t c){
	if(x>9 || y>17)
		return;
	int8_t sx=x;
	int8_t sy=y;
	if(sx<0){
		w+=sx;
		if(w<1)
			return;
		sx=0;
	}
	if(sy<0){
		h+=sy;
		if(h<1)
			return;
		sy=0;
	}
	w=sx+w;
	h=sy+h;
	if(w>10)
		w=10;
	if(h>18)
		h=18;
	for(int8_t n=sx;n<w;n++){
		for(int8_t i=sy;i<h;i++){
			plot(n,i,c);
		}
	}
}

// Draws big chars at a Y position - they are always centred on the display for speed
void drawChar(uint8_t charIX,int16_t yPos, uint8_t c){
	if(yPos>17 || yPos<-7 || c==0)
		return;
	uint16_t ix=charIX<<4;
	yPos<<=1;
	for(uint8_t n=0;n<8;n++){
		if(yPos>-1 && yPos<36){
			buffer[drawBuffer][yPos]=charDef[ix];
			buffer[drawBuffer][yPos+1]=charDef[ix+1];
			if(c>1){
				buffer[drawBuffer][yPos+MAX_COL]=charDef[ix];
				buffer[drawBuffer][yPos+1+MAX_COL]=charDef[ix+1];
			}
		}
		yPos+=2;
		ix+=2;
	}
}

// Draw a vertical string at position y - used for initial title, and score display
void drawText(char *s,int16_t yPos, uint8_t c){
	char chr;
	while(*s){
		chr=*s++;
		if(chr>='0' && chr<='9'){
			drawChar(chr+25-'0',yPos,c);
		}else if(chr>='A' && chr<='Z'){
			drawChar(chr-'A',yPos,c);
		}
		yPos+=9;
	}
}

// Fast blit for horizontal lines spanning full width. Used for the "screen collapse" animation
void fastHLine(int8_t yPos,uint8_t c){
	if(yPos<0 || yPos>17)
		return;
	yPos<<=1;
	switch(c){
		case 0:
			buffer[drawBuffer][yPos]=0;
			buffer[drawBuffer][yPos+1]=0;
			buffer[drawBuffer][yPos+MAX_COL]=0;
			buffer[drawBuffer][yPos+1+MAX_COL]=0;
		break;
		case 1:
			buffer[drawBuffer][yPos]=0b11111;
			buffer[drawBuffer][yPos+1]=0b11111;
			buffer[drawBuffer][yPos+MAX_COL]=0;
			buffer[drawBuffer][yPos+1+MAX_COL]=0;
		break;
		case 2:
			buffer[drawBuffer][yPos]=0b11111;
			buffer[drawBuffer][yPos+1]=0b11111;
			buffer[drawBuffer][yPos+MAX_COL]=0b11111;
			buffer[drawBuffer][yPos+1+MAX_COL]=0b11111;
		break;
	}
}

// Guess :-) Score and hi-score display should have really been in the Tetris game file, but
// I was going to also add a scrolling maze game, so wanted to share this. Turned out to only
// have the Tetris game (well, and Game of Life) so not really needed here.
void showScore(uint16_t s, uint8_t type){
	char sA[6]="";
	int8_t ix=5;
	while(s>0){
		sA[ix--]=s%10;
		s/=10;
	}
	if(ix<5)
		++ix;
	const uint8_t textLen=(type==0?5:2);
	const uint8_t numOff=(type==0?50:23);
	int16_t yPos=18;
	int16_t sHeight=((textLen+7-ix)*9)-4;
	while(yPos-->-sHeight){
		clearBuffer();
		if(type==0){
			drawText("SCORE",yPos,1);
		}else{
			drawText("HI",yPos,1);
		}
		s=0;
		for(uint8_t n=ix;n<6;n++){
			drawChar(sA[n]+26,yPos+numOff+s,2);
			s+=9;
		}
		
		flipBuffers();
		getButtonState();
		if(butPressed(BUTTON_ON_OFF)){
			clearBuffer();
			flipBuffers();
			waitBut();
			return;
		}
		_delay_ms(SHOW_SCORE_DELAY);
	}
}

// Shows the "menu". Initially this would have shown different games,
// but I ran out of time on the project, so it auto-jumps out to the
// Tetris game
uint8_t doMenu(void){
	uint8_t dotOff=0;
	uint8_t amp=0;
	uint16_t cnt=0;
	int8_t logoOff=-4;
	
	while(1){

		clearBuffer();

		if(cnt%2){
			if(++dotOff==4)
				dotOff=0;
			if(amp<5 && cnt<15)
				++amp;
		}

		if(cnt>15 && cnt<30){
			if(logoOff<6)
				++logoOff;
		}else if(cnt>40 && cnt<55){
			if(logoOff>-4)
				--logoOff;
		}
		if(cnt>15 && cnt<55){
			drawBlock(3,logoOff,2,4, (logoOff==6?2:1));
			drawBlock(5,14-logoOff,2,4, (logoOff==6?2:1));
		}else if(cnt==55){
			logoOff=18;
		}else if(cnt>55 && cnt<130){
			if(logoOff>-54)
				--logoOff;
			drawText("TETRIS",logoOff, 1);
		}else if(cnt>130 && cnt<136){
			if(amp>0)
				--amp;
		}else if(cnt==136){
			logoOff=-8;
		}else if(cnt>136 && cnt<142){
			drawText("GO",logoOff, 2);
			if(logoOff<0){
				logoOff+=2;
			}
		}else if(cnt>141 && cnt<155){
			if(cnt%2){
				drawText("GO",logoOff, 2);
			}
		}else if(cnt==155){
			clearBuffer();
			flipBuffers();
			return 1;
		}
		
		if(cnt<136){
			drawSpinner(dotOff,amp);
		}

		flipBuffers();
		++cnt;
		getButtonState();
		if(butPressed(BUTTON_ON_OFF)){
			clearBuffer();
			flipBuffers();
			waitBut();
			return 0;
		}
		_delay_ms(INTRO_DELAY);
	}
	return 1;
}

// Check if a specific button is pressed
uint8_t butPressed(uint8_t which){
	return butState&(1<<which);
}

// Wait until no buttons are pressed
void waitBut(void){
	uint16_t reps=0;
	_delay_ms(10);
	while(1){
		++reps;
		getButtonState();
		if(!butState){
			srand(reps);
			_delay_ms(10);
			return;
		}
	}
}

// Populates a bit field with current button press states
uint8_t getButtonState(void){
	butState=0;
	// Set up ADC to use AVCC, 8 bit conversion, and set mux to C5
	ADMUX = (1<<REFS0) + (1<<ADLAR) + 0b101;
	// Enable MUX, start conversion, with divisor of 128 - low speed
	ADCSRA = (1<<ADEN)+(1<<ADPS2)+(1<<ADPS1); //+(1<<ADPS0);
	ADCSRA|=(1<<ADSC);
	while(ADCSRA&(1<<ADSC));	// Wait for conversion
	uint8_t v=ADCH>>4;
	if(v<FAST_DROP_ADC)	// fast drop button
		butState|=(1<<BUTTON_FAST_DROP);
	else if(v<SPIN_ADC)
		butState|=(1<<BUTTON_SPIN);
		
	// Set up ADC to use AVCC, 8 bit conversion, and set mux to C4
	ADMUX = (1<<REFS0) + (1<<ADLAR) + 0b100;
	ADCSRA|=(1<<ADSC);
	while(ADCSRA&(1<<ADSC));	// Wait for conversion
	v=ADCH>>4;
	ADCSRA=0;	// Disable ADC to save power
#if(VER==1)
	if(v<DOWN_ADC)	// fast drop button
		butState|=(1<<BUTTON_DOWN);
	else if(v<LEFT_ADC)
		butState|=(1<<BUTTON_LEFT);
	else if(v<RIGHT_ADC)
		butState|=(1<<BUTTON_RIGHT);
	if((PIND&(1<<BUT_ON_OFF))==0)
		butState|=(1<<BUTTON_ON_OFF);
#elif(VER==2)
	if(v<RIGHT_ADC)
		butState|=(1<<BUTTON_RIGHT);
	else if(v<LEFT_ADC)
		butState|=(1<<BUTTON_LEFT);
	else if(v<DOWN_ADC)	// fast drop button
		butState|=(1<<BUTTON_DOWN);
#endif
	return butState;
}

// For debugging, displays the current button states on the display using blocks
void showButtonStates(void){
	uint8_t side=0;
	while(1){
		clearBuffer();
		getButtonState();
		for(uint8_t n=0;n<6;n++){
			if(butState&(1<<n)){
				drawBlock(0,n*3,2,2, 2);
			}
		}
		plot(9,side, 2);
		if(++side==18)
			side=0;
		flipBuffers();
		_delay_ms(1);
	}
}

// Test the ADC values of buttons. Line 1262 (0b100) needs changing if you want to check
// the right or left buttons.
void testButtons(void){
	uint8_t side=0;
	while(1){
		clearBuffer();
		// Set up ADC to use AVCC, 8 bit conversion, and set mux to C4
		ADMUX = (1<<REFS0) + (1<<ADLAR) + 0b100;
		// Enable MUX, start conversion, with divisor of 128 - low speed
		ADCSRA = (1<<ADEN)+(1<<ADPS2)+(1<<ADPS1)+(1<<ADPS0);
		ADCSRA|=(1<<ADSC);
		while(ADCSRA&(1<<ADSC));	// Wait for conversion
		uint8_t v=ADCH;
		drawBlock(0,0,9,v>>4, 2);
		plot(9,side, 2);
		if(++side==18)
			side=0;
		flipBuffers();
		_delay_ms(20);
	}	
}

// Perform shutdown animation. Was used when card went to sleep in V1 boards,
// but now displays after game ends.
void shutdown(void){

	for(uint8_t n=0;n<9;n++){
		copyToBackBuffer();
		fastHLine(n,2);
		fastHLine(17-n,2);
		fastHLine(n-1,1);
		fastHLine(18-n,1);
		flipBuffers();
		_delay_ms(5);
	}
	_delay_ms(30);
	for(uint8_t n=0;n<9;n++){
		copyToBackBuffer();
		fastHLine(n,0);
		fastHLine(17-n,0);
		flipBuffers();
	}
	for(int8_t n=0;n<10;n++){
		clearBuffer();
		if(n%2){
			fastHLine(8,2);
			fastHLine(9,2);
		}
		flipBuffers();
		_delay_ms(3);
	}
	for(int8_t n=0;n<5;n++){
		clearBuffer();
		drawLine(n,8,10-(n*2),0, 2);
		drawLine(n,9,10-(n*2),0, 2);
		flipBuffers();
		_delay_ms(1);
	}
	clearBuffer();
	flipBuffers();
}

// Just updates the display slowly to show each 5 pixel section in isolation for debugging/testing
void testDisplay(void){
	uint8_t seg=0;
	while(1){
		clearBuffer();
		buffer[drawBuffer][seg]=0b11111;
		flipBuffers();
		if(++seg==MAX_COL)
			seg=0;
		_delay_ms(5);
	}
}

// Shows the cog spinner Solder animation. This is accessed by holding down LEFT while turning on
// the power, then releasing LEFT.
void spinCog(void){
	int16_t ix=0;
	while(1){
		displayVideoFrame(cogSpinner,ix);
		flipBuffers();
		if(++ix==150)
			break;
	}

	while(1){
		uint8_t bState=getButtonState();
		if(bState){
			if(butPressed(BUTTON_RIGHT)){
				--ix;
				if(ix<=100){
					ix=150;
				}
			}else if(butPressed(BUTTON_LEFT)){
				++ix;
				if(ix>=150){
					ix=100;
				}
			}
			if(butPressed(BUTTON_SPIN)){
				break;
			}
			
			displayVideoFrame(cogSpinner,ix);
			flipBuffers();
		}
	}
	
	while(ix<165){
		displayVideoFrame(cogSpinner,ix);
		flipBuffers();
		++ix;
	}
	
}

// Displays the 3d Solder Logo animation. LEFT and RIGHT can be used to rotate the logo
// after it appears. SPIN exits back to the game. As an aside, this was initially rendered
// in 3D on the card using pseudo-polygons, but as I also wanted to add the cog animation,
// I was a bit short on space, and so now render it as another animation. Sneaky :)
void spinLogo(void){
	int16_t ix=0;
	while(1){
		displayVideoFrame(logoSpinner,ix);
		flipBuffers();
		++ix;
		if(ix>=180){
			ix=120;
			displayVideoFrame(logoSpinner,ix);	
			flipBuffers();
			break;
		}
	}	

	while(1){
		uint8_t bState=getButtonState();
		if(bState){
			if(butPressed(BUTTON_LEFT)){
				--ix;
				if(ix<=120){
					ix=179;
				}
			}else if(butPressed(BUTTON_RIGHT)){
				++ix;
				if(ix>=180){
					ix=120;
				}
			}
			if(butPressed(BUTTON_SPIN)){
				break;
			}
			
			displayVideoFrame(logoSpinner,ix);
			flipBuffers();
		}
	}
	
	while(ix>0){
		displayVideoFrame(logoSpinner,ix);
		flipBuffers();
		--ix;
	}
}
